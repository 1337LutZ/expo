{"version":3,"file":"DevMenuBottomSheet.js","sourceRoot":"","sources":["../../../src/app/views/DevMenuBottomSheet.tsx"],"names":[],"mappings":"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","sourcesContent":["import { createStackNavigator, Header, HeaderBackButton } from '@react-navigation/stack';\nimport React from 'react';\nimport {\n  EventSubscription,\n  StyleSheet,\n  TouchableWithoutFeedback,\n  View,\n  Dimensions,\n  TouchableOpacity,\n} from 'react-native';\nimport Animated from 'react-native-reanimated';\n\nimport DevMenuContext from '../DevMenuContext';\nimport { closeMenuAsync } from '../DevMenuInternal';\nimport Colors from '../constants/Colors';\nimport * as DevMenu from './DevMenuModule';\nimport BottomSheet from './BottomSheet';\nimport ScrollBottomSheet from './ScrollBottomSheet';\nimport DevMenuMainScreen from '../screens/DevMenuMainScreen';\nimport LayoutRuler from '../components/LayoutRuler';\n\nconst Stack = createStackNavigator();\nconst BOTTOM_PADDING = 40;\n\ntype Props = {\n  uuid: string;\n};\n\n// @refresh\nclass DevMenuBottomSheet extends React.PureComponent<Props, any> {\n  ref = React.createRef<BottomSheet>();\n  // ref = React.createRef<ScrollBottomSheet<any>>();\n\n  snapPoints = [0, '60%', '75%', '90%'];\n  // snapPoints = ['10%', '35%', '100%'];\n\n  callbackNode = new Animated.Value(0);\n\n  backgroundOpacity = this.callbackNode.interpolate({\n    inputRange: [0, 1],\n    outputRange: [0.5, 0],\n    // outputRange: [0, 0.5],\n  });\n\n  closeSubscription: EventSubscription | null = null;\n\n  constructor(props) {\n    super(props);\n\n    this.sheetHeightSet = false;\n    this.sheetHeight.setValue(Dimensions.get('window').height);\n  }\n\n  componentDidMount() {\n    this.expand();\n\n    // Before the dev menu can be actually closed, we need to collapse its sheet view,\n    // and this listens for close requests that come from native side to start collapsing the view.\n    // The awaited return value of this listener is then send back as a response\n    // so the native module knows when it can fully close dev menu (detach its root view).\n    this.closeSubscription = DevMenu.listenForCloseRequests(() => {\n      // Unsubscribe immediately so we don't accidentally collapse twice.\n      // Also componentWillUnmount is not called (why?) when the app is hot reloading this component,\n      // despite the componentDidMount is later called after first render.\n      this.unsubscribeCloseSubscription();\n\n      // `collapse` returns a promise, so this `return` is important to finish the close event once the view is fully collapsed.\n      return this.collapse();\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    // Make sure it gets expanded once we receive new identifier.\n    if (prevProps.uuid !== this.props.uuid) {\n      this.expand();\n    }\n  }\n\n  componentWillUnmount() {\n    this.unsubscribeCloseSubscription();\n  }\n\n  collapse = (): Promise<void> => {\n    this.ref.current?.snapTo(0);\n    // this.ref.current && this.ref.current.snapTo(this.snapPoints.length - 1);\n\n    // Use setTimeout until there is a better solution to execute something once the sheet is fully collapsed.\n    return new Promise(resolve => setTimeout(resolve, 300));\n  };\n\n  collapseAndClose = async () => {\n    await this.collapse();\n    await closeMenuAsync();\n  };\n\n  expand = () => {\n    this.ref.current && this.ref.current.snapTo(1);\n  };\n\n  unsubscribeCloseSubscription = () => {\n    if (this.closeSubscription) {\n      this.closeSubscription.remove();\n      this.closeSubscription = null;\n    }\n  };\n\n  onCloseEnd = () => {\n    this.collapseAndClose();\n  };\n\n  providedContext = {\n    expand: this.expand,\n    collapse: this.collapse,\n  };\n\n  // renderContentOld = () => {\n  //   return <View style={styles.bottomSheetContent}>{this.props.children}</View>;\n  // };\n\n  sheetHeight = new Animated.Value(10000);\n  sheetHeightSet = false;\n\n  onSheetHeightMeasure = (height: number) => {\n    console.log(height);\n    if (!this.sheetHeightSet && height > 0) {\n      this.sheetHeight.setValue(height + BOTTOM_PADDING);\n      this.sheetHeightSet = true;\n    }\n  };\n\n  renderScreen = screen => {\n    const ScreenComponent = screen.component;\n\n    return (\n      <Stack.Screen key={screen.name} name={screen.name} options={screen.options}>\n        {props => (\n          <LayoutRuler property=\"height\" onMeasure={this.onSheetHeightMeasure}>\n            <ScreenComponent {...props} />\n          </LayoutRuler>\n        )}\n      </Stack.Screen>\n    );\n  };\n\n  renderHeader = () => {\n    return (\n      <View style={styles.bottomSheetHeader}>\n        <HeaderBackButton />\n      </View>\n    );\n  };\n\n  renderContent = () => {\n    return (\n      <Animated.View style={[styles.bottomSheetContent, { height: this.sheetHeight }]}>\n        <Stack.Navigator initialRouteName=\"Main\" headerMode=\"float\">\n          {this.screens.map(this.renderScreen)}\n        </Stack.Navigator>\n      </Animated.View>\n    );\n  };\n\n  screens = [\n    {\n      name: 'Main',\n      component: DevMenuMainScreen,\n      options: DevMenuMainScreen.navigationOptions,\n    },\n    {\n      name: 'Test',\n      component: TestScreen,\n      options: TestScreen.navigationOptions,\n    },\n    {\n      name: 'Test2',\n      component: TestScreen,\n      options: TestScreen.navigationOptions,\n    },\n    {\n      name: 'Test3',\n      component: TestScreen,\n      options: TestScreen.navigationOptions,\n    },\n  ];\n\n  render() {\n    const providedContext = {\n      ...this.props,\n      ...this.providedContext,\n    };\n\n    return (\n      <DevMenuContext.Provider value={providedContext}>\n        <View style={styles.bottomSheetContainer}>\n          <TouchableWithoutFeedback onPress={this.collapseAndClose}>\n            <Animated.View\n              style={[styles.bottomSheetBackground, { opacity: this.backgroundOpacity }]}\n            />\n          </TouchableWithoutFeedback>\n          <BottomSheet\n            ref={this.ref}\n            initialSnap={0}\n            snapPoints={this.snapPoints}\n            borderRadius={10}\n            enabledInnerScrolling\n            enabledContentGestureInteraction\n            callbackNode={this.callbackNode}\n            renderHeader={this.renderHeader}\n            renderContent={this.renderContent}\n          />\n          {/* <ScrollBottomSheet\n            ref={this.ref}\n            componentType=\"ScrollView\"\n            snapPoints={this.snapPoints}\n            initialSnapIndex={this.snapPoints.length - 1}\n            animatedPosition={this.callbackNode}\n            renderHandle={() => null}\n            screens={this.screens}\n            contentContainerStyle={styles.bottomSheetContentContainer}\n            style={styles.bottomSheet}>\n            {this.renderContent()}\n          </ScrollBottomSheet> */}\n        </View>\n      </DevMenuContext.Provider>\n    );\n  }\n}\n\nclass TestScreen extends React.PureComponent {\n  static navigationOptions = {\n    headerShown: true,\n  };\n\n  static contextType = DevMenuContext;\n\n  render() {\n    return (\n      <View style={{ flex: 1 }}>\n        <View\n          style={{\n            height: 400,\n            justifyContent: 'center',\n            alignItems: 'center',\n            backgroundColor: 'blue',\n            borderBottomColor: 'yellow',\n            borderBottomWidth: 2,\n          }}>\n          <TouchableOpacity onPress={() => this.props.navigation.push('Test2')}>\n            <View style={{ height: 100, width: 100, backgroundColor: 'green' }} />\n          </TouchableOpacity>\n        </View>\n        <View\n          style={{\n            height: 400,\n            backgroundColor: 'blue',\n            borderBottomColor: 'yellow',\n            borderBottomWidth: 2,\n          }}\n        />\n        <View\n          style={{\n            height: 400,\n            backgroundColor: 'blue',\n            borderBottomColor: 'yellow',\n            borderBottomWidth: 2,\n          }}\n        />\n        <View\n          style={{\n            height: 400,\n            backgroundColor: 'blue',\n            borderBottomColor: 'yellow',\n            borderBottomWidth: 2,\n          }}\n        />\n        <View\n          style={{\n            height: 400,\n            backgroundColor: 'blue',\n            borderBottomColor: 'yellow',\n            borderBottomWidth: 2,\n          }}\n        />\n        <View\n          style={{\n            height: 400,\n            backgroundColor: 'blue',\n            borderBottomColor: 'yellow',\n            borderBottomWidth: 2,\n          }}\n        />\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  bottomSheetContainer: {\n    flex: 1,\n  },\n  bottomSheetBackground: {\n    flex: 1,\n    backgroundColor: '#000',\n  },\n  bottomSheetHeader: {\n    height: 40,\n    backgroundColor: Colors.dark.menuBackground,\n  },\n  bottomSheetContent: {\n    paddingBottom: BOTTOM_PADDING,\n    backgroundColor: Colors.dark.menuBackground,\n  },\n});\n\nexport default DevMenuBottomSheet;\n"]}